import random
from data_set import Data
from makespan import Solution


def generate_feasible_solution():
    """
    Generates a random feasible solution.

    :return: a random feasible solution
    """

    operation_list = []
    available = {job.get_job_id(): [task for task in job.get_tasks() if task.get_sequence() == 0] for job in Data.jobs.values()}

    while 0 < len(available):
        rand_job_id = random.choice(list(available.keys()))
        rand_task = available[rand_job_id].pop(random.randrange(len(available[rand_job_id])))
        rand_machine = rand_task.get_usable_machines()[random.randrange(len(rand_task.get_usable_machines()))]

        if len(available[rand_job_id]) == 0:
            if rand_task.get_sequence() == Data.get_job(rand_job_id).get_max_sequence():
                available.pop(rand_job_id)
            else:
                available[rand_job_id] = [task for task in Data.get_job(rand_job_id).get_tasks() if task.get_sequence() == rand_task.get_sequence() + 1]

        operation_list.append([rand_job_id, rand_task.get_task_id(), rand_task.get_sequence(), rand_machine, rand_task.get_pieces()])
    return Solution(operation_list)


def get_small_test_solution():
    return Solution([[0, 0, 0, 0, 10],
                     [0, 1, 1, 1, 5],
                     [1, 0, 0, 1, 8],
                     [2, 0, 0, 0, 8],
                     [1, 1, 1, 0, 5]])


def get_large_test_solution():
    return Solution(get_large_test_operation_list())


def get_large_test_operation_list():
    return [[0, 0, 0, 5, 19116],
            [0, 1, 1, 0, 7897],
            [0, 2, 2, 1, 23430],
            [0, 3, 2, 2, 21321],
            [0, 4, 3, 0, 15368],
            [0, 5, 3, 4, 23025],
            [0, 6, 4, 7, 20115],
            [1, 0, 0, 6, 22455],
            [1, 1, 1, 6, 19165],
            [1, 2, 1, 2, 8762],
            [1, 3, 2, 5, 18824],
            [1, 4, 2, 2, 9305],
            [2, 0, 0, 4, 19368],
            [2, 1, 1, 6, 20875],
            [2, 2, 1, 2, 12997],
            [2, 3, 1, 3, 6134],
            [2, 4, 2, 6, 20588],
            [3, 0, 0, 4, 20912],
            [3, 1, 1, 5, 10103],
            [3, 2, 1, 0, 6162],
            [3, 3, 2, 5, 22582],
            [3, 4, 3, 7, 8886],
            [3, 5, 3, 2, 10208],
            [4, 0, 0, 1, 5136],
            [4, 1, 0, 3, 14753],
            [4, 2, 0, 0, 7562],
            [4, 3, 1, 4, 5967],
            [5, 0, 0, 4, 19299],
            [5, 1, 1, 6, 10311],
            [5, 2, 1, 3, 24469],
            [5, 3, 1, 2, 14500],
            [5, 4, 2, 5, 16471],
            [6, 0, 0, 6, 10410],
            [6, 1, 0, 5, 23491],
            [6, 2, 0, 3, 23424],
            [6, 3, 1, 5, 14671],
            [6, 4, 2, 3, 7660],
            [6, 5, 2, 6, 6053],
            [7, 0, 0, 5, 24441],
            [7, 1, 1, 0, 12152],
            [7, 2, 1, 6, 23886],
            [7, 3, 2, 2, 19705],
            [8, 0, 0, 0, 9776],
            [8, 1, 0, 2, 6671],
            [8, 2, 1, 6, 10343],
            [9, 0, 0, 1, 12528],
            [9, 1, 0, 1, 11598],
            [9, 2, 0, 2, 5404],
            [10, 0, 0, 6, 9515],
            [10, 1, 1, 2, 9736],
            [10, 2, 2, 0, 10801],
            [10, 3, 2, 2, 14961],
            [11, 0, 0, 1, 7757],
            [11, 1, 1, 4, 8868],
            [11, 2, 1, 2, 14037],
            [12, 0, 0, 4, 8191],
            [12, 1, 1, 2, 11282],
            [12, 2, 1, 0, 13639],
            [12, 3, 2, 2, 6938],
            [12, 4, 2, 1, 15030],
            [12, 5, 3, 4, 17910],
            [13, 0, 0, 4, 17404],
            [13, 1, 0, 3, 11007],
            [13, 2, 1, 2, 12426],
            [14, 0, 0, 1, 14120],
            [14, 1, 0, 1, 12719],
            [14, 2, 1, 6, 15681],
            [14, 3, 2, 6, 10604],
            [14, 4, 3, 4, 5266],
            [14, 5, 4, 0, 12500],
            [14, 6, 5, 1, 19098],
            [15, 0, 0, 5, 16301],
            [15, 1, 0, 6, 23821],
            [15, 2, 1, 5, 5592],
            [15, 3, 1, 5, 12935],
            [16, 0, 0, 4, 7276],
            [16, 1, 1, 2, 17263],
            [16, 2, 1, 0, 16528],
            [17, 0, 0, 6, 11056],
            [17, 1, 1, 7, 14425],
            [17, 2, 1, 6, 21151],
            [18, 0, 0, 7, 22705],
            [18, 1, 0, 3, 9378],
            [18, 2, 0, 0, 16528],
            [19, 0, 0, 1, 23693],
            [19, 1, 1, 5, 24480],
            [19, 2, 1, 4, 10802],
            [19, 3, 2, 5, 9207],
            [19, 4, 2, 7, 19937],
            [20, 0, 0, 7, 9039],
            [20, 1, 0, 3, 9791],
            [20, 2, 0, 7, 10305],
            [21, 0, 0, 1, 19015],
            [21, 1, 0, 6, 8467],
            [21, 2, 1, 4, 9940],
            [21, 3, 2, 0, 6510],
            [21, 4, 3, 4, 12909],
            [21, 5, 3, 1, 22744],
            [22, 0, 0, 6, 18595],
            [22, 1, 1, 4, 11091],
            [22, 2, 1, 7, 14690],
            [23, 0, 0, 3, 11822],
            [23, 1, 1, 7, 8995],
            [23, 2, 1, 7, 11835],
            [24, 0, 0, 5, 19234],
            [24, 1, 0, 4, 7274],
            [24, 2, 1, 4, 19967],
            [24, 3, 1, 1, 6004],
            [24, 4, 2, 2, 13686],
            [24, 5, 3, 0, 21549],
            [24, 6, 4, 5, 14392],
            [25, 0, 0, 4, 21419],
            [25, 1, 0, 7, 6435],
            [25, 2, 1, 4, 19971],
            [25, 3, 1, 4, 22548],
            [26, 0, 0, 4, 14926],
            [26, 1, 1, 6, 24991],
            [26, 2, 1, 0, 23287],
            [26, 3, 2, 1, 7893],
            [27, 0, 0, 1, 18694],
            [27, 1, 1, 3, 19931],
            [27, 2, 2, 6, 22265],
            [28, 0, 0, 4, 12651],
            [28, 1, 0, 1, 9295],
            [28, 2, 1, 2, 20811],
            [28, 3, 2, 0, 14218],
            [28, 4, 3, 1, 13993],
            [29, 0, 0, 4, 5945],
            [29, 1, 0, 7, 22740],
            [29, 2, 1, 6, 17772],
            [29, 3, 2, 7, 6080],
            [29, 4, 2, 4, 19286],
            [30, 0, 0, 7, 7321],
            [30, 1, 1, 7, 8248],
            [30, 2, 1, 3, 15242],
            [30, 3, 1, 6, 14015],
            [30, 4, 1, 2, 15587],
            [31, 0, 0, 0, 23700],
            [31, 1, 1, 1, 19744],
            [31, 2, 1, 3, 12197],
            [31, 3, 2, 2, 12278],
            [31, 4, 3, 5, 14576],
            [31, 5, 4, 6, 20920],
            [31, 6, 5, 2, 23583],
            [32, 0, 0, 1, 6873],
            [32, 1, 0, 0, 9820],
            [32, 2, 1, 3, 22800],
            [32, 3, 2, 5, 6097],
            [32, 4, 3, 0, 8333],
            [32, 5, 4, 4, 16111],
            [33, 0, 0, 6, 11149],
            [33, 1, 1, 3, 24602],
            [33, 2, 2, 5, 11337],
            [33, 3, 3, 3, 22332],
            [33, 4, 4, 6, 10779],
            [34, 0, 0, 7, 11834],
            [34, 1, 0, 0, 10103],
            [34, 2, 0, 1, 8216],
            [34, 3, 1, 1, 23776],
            [34, 4, 2, 4, 18747],
            [35, 0, 0, 5, 6339],
            [35, 1, 1, 6, 23906],
            [35, 2, 2, 1, 20394],
            [35, 3, 2, 5, 7441],
            [35, 4, 3, 2, 12255],
            [36, 0, 0, 5, 17058],
            [36, 1, 0, 6, 8454],
            [36, 2, 1, 5, 10940],
            [36, 3, 2, 0, 9829],
            [37, 0, 0, 6, 17820],
            [37, 1, 1, 5, 10410],
            [37, 2, 1, 5, 15582],
            [37, 3, 1, 6, 5492],
            [37, 4, 2, 0, 5851],
            [37, 5, 3, 3, 18997],
            [38, 0, 0, 0, 6394],
            [38, 1, 1, 1, 24718],
            [38, 2, 2, 7, 6400],
            [39, 0, 0, 6, 14987],
            [39, 1, 0, 7, 20864],
            [39, 2, 1, 1, 18773],
            [40, 0, 0, 1, 19590],
            [40, 1, 1, 2, 20581],
            [40, 2, 2, 5, 8506],
            [40, 3, 3, 3, 9698],
            [40, 4, 3, 6, 8278],
            [41, 0, 0, 1, 9564],
            [41, 1, 1, 5, 12992],
            [41, 2, 1, 1, 7366],
            [41, 3, 2, 4, 10442],
            [41, 4, 2, 3, 22134],
            [41, 5, 2, 3, 7556],
            [42, 0, 0, 3, 18461],
            [42, 1, 1, 1, 20199],
            [42, 2, 2, 5, 17151],
            [43, 0, 0, 6, 7688],
            [43, 1, 1, 3, 17933],
            [43, 2, 1, 1, 11724],
            [44, 0, 0, 5, 24123],
            [44, 1, 0, 3, 10819],
            [44, 2, 1, 6, 6851],
            [44, 3, 2, 5, 13973],
            [44, 4, 3, 7, 14655],
            [44, 5, 4, 6, 10137],
            [45, 0, 0, 5, 21425],
            [45, 1, 0, 1, 5303],
            [45, 2, 0, 3, 12334],
            [46, 0, 0, 4, 16423],
            [46, 1, 0, 2, 5080],
            [46, 2, 1, 6, 24610],
            [47, 0, 0, 3, 21652],
            [47, 1, 1, 7, 18254],
            [47, 2, 2, 4, 12399],
            [47, 3, 2, 2, 14515],
            [48, 0, 0, 2, 17294],
            [48, 1, 1, 7, 10308],
            [48, 2, 2, 6, 15677],
            [48, 3, 3, 4, 10250],
            [48, 4, 4, 1, 8556],
            [49, 0, 0, 2, 17091],
            [49, 1, 1, 0, 23582],
            [49, 2, 1, 0, 22270]]
